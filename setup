#!/bin/bash

# Argument $1: The name of the Homebrew package
# Argument $2: Optional custom code to run instead of Homebrew install
check_dependency () {
  command -v "$1" >/dev/null 2>&1
  if [[ ! "$?" -eq 0 ]]; then
    if [[ -z "$2" ]]; then
      printf "Installing %s\n" "$1"
      brew update
      brew install "$1"
    else
      printf "Executing custom commands:\n"
      eval "$2"
    fi
  fi
}

# Run Homebrew setup
./homebrew/setup

# Run Neovim setup
./neovim/setup

# TODO: Do this the right way.
# Install prettier-standard (since we use this for work)
check_dependency "prettier-standard" "npm i prettier-standard -g"
check_dependency "language-server" "npm i javascript-typescript-langserver -g"

# Install global ESLint and Vue plugin
check_dependency "eslint" "npm i -g eslint eslint-plugin-vue"

# TODO: This should be part of the Node.js setup file
# Install the Neovim NPM package
if [[ ! "$(npm ls -g --depth=0)" =~ "neovim" ]]; then
  printf "Installing neovim NPM package:\n"
  npm i neovim -g
fi

# TODO: This should be part of the Ruby setup file.
if [[ ! "$(gem list)" =~ "neovim" ]]; then
  printf "Installing the Neovim Ruby Gem:\n"
  gem install neovim
fi

# TODO: This should be somewhere else; but I'm putting it here for now. :P
project_dir=~/Projects

for directory in $(ls $project_dir); do
  if [[ -d $project_dir/$directory ]] && [[ -d $project_dir/$directory/.git ]]; then
    cd $project_dir/$directory
    git checkout master
    git fetch --all
    git pull
  fi
done

cd ~
